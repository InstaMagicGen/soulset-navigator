<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Soulset Navigator â€¢ Therapeutic Support</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    body{
      margin:0;
      font-family:Nunito, sans-serif;
      background:#050811;
      color:#f3f6ff;
      -webkit-font-smoothing:antialiased;
    }

    /* BACKGROUND SLIDESHOW â€“ FULLSCREEN + KEN BURNS EFFECT */
    .background-slideshow {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100vh;
      overflow: hidden;
      z-index: -2;
    }
    .background-slideshow .slide{
      position:absolute;
      top:-5%;
      left:-5%;
      width:110%;
      height:110%;
      object-fit:cover;
      opacity:0;
      transition:opacity 2.5s ease-in-out;
      animation:kenburns 22s ease-in-out infinite;
    }
    .background-slideshow .slide.active{
      opacity:1;
    }
    @keyframes kenburns{
      0%{transform:scale(1);}
      50%{transform:scale(1.08);}
      100%{transform:scale(1);}
    }

    /* Dark gradient overlay to keep text readable */
    .bg-overlay{
      position:fixed;
      inset:0;
      background:radial-gradient(circle at top, rgba(120,150,255,0.35), transparent 55%),
                 linear-gradient(to bottom, rgba(0,0,0,0.78), rgba(0,0,0,0.9));
      z-index:-1;
    }

    /* Layout container */
    .page{
      min-height:100vh;
    }
    header{
      text-align:center;
      padding:30px 20px 8px;
    }
    header h1{
      font-family:"Playfair Display", serif;
      font-size:clamp(28px,4.8vw,38px);
      margin:0;
      letter-spacing:.04em;
    }
    header .subtitle{
      opacity:0.9;
      font-size:15px;
      margin-top:10px;
      max-width:520px;
      margin-left:auto;
      margin-right:auto;
    }

    .container{
      max-width:860px;
      margin:0 auto;
      padding:18px 20px 80px;
    }

    .card{
      background:rgba(6,12,28,0.92);
      border-radius:22px;
      padding:22px 20px;
      box-shadow:0 16px 40px rgba(0,0,0,0.45);
      margin-bottom:26px;
      border:1px solid rgba(255,255,255,0.04);
      backdrop-filter:blur(18px);
    }

    .card h2{
      margin:0 0 10px;
      font-size:20px;
      font-family:"Playfair Display", serif;
      letter-spacing:.03em;
    }

    .card p{
      margin-top:0;
      font-size:14px;
      color:#ccd4ff;
    }

    textarea{
      width:100%;
      min-height:110px;
      border-radius:14px;
      border:1.5px solid rgba(190,205,255,0.45);
      padding:14px;
      font-size:16px;
      background:rgba(5,10,30,0.9);
      resize:vertical;
      outline:none;
      color:#f3f6ff;
    }
    textarea::placeholder{
      color:#8992c5;
    }

    .actions{
      display:flex;
      gap:12px;
      margin-top:14px;
      flex-wrap:wrap;
    }

    .btn{
      flex:1;
      border:0;
      padding:13px 16px;
      border-radius:14px;
      font-size:15px;
      font-weight:700;
      cursor:pointer;
      background:#5aa3a6;
      color:white;
      box-shadow:0 10px 24px rgba(0,0,0,0.45);
    }
    .btn.secondary{
      background:transparent;
      border:1px solid rgba(190,205,255,0.45);
      color:#d7e0ff;
    }
    .btn:disabled{
      opacity:0.6;
      cursor:not-allowed;
    }

    #status{
      margin-top:10px;
      font-size:13px;
      color:#d0d8ff;
    }

    #result .bubble{
      margin-top:18px;
      background:rgba(4,10,30,0.96);
      padding:16px 18px;
      border-radius:16px;
      box-shadow:0 10px 30px rgba(0,0,0,0.6);
      line-height:1.65;
      white-space:pre-line;
      border:1px solid rgba(163,186,255,0.28);
      color:#eef2ff;
      font-size:15px;
    }

    .sunset-block{
      display:none;
      text-align:center;
      margin-top:10px;
    }
    .sunset-btn{
      background:rgba(9,20,55,0.9);
      padding:12px 22px;
      border-radius:18px;
      font-weight:700;
      box-shadow:0 10px 26px rgba(0,0,0,0.6);
      backdrop-filter:blur(14px);
      color:#f3f6ff;
      border:1px solid rgba(190,205,255,0.4);
      font-size:15px;
    }

    /* IMMERSIVE SUNSET RESET */
    .sunset-fullscreen{
      position:fixed;
      inset:0;
      background:black;
      display:none;
      justify-content:center;
      align-items:center;
      flex-direction:column;
      z-index:9999;
    }
    .sunset-fullscreen video{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .sunset-close{
      position:absolute;
      top:26px;
      right:24px;
      font-size:28px;
      color:white;
      padding:6px 14px;
      background:#ffffff33;
      border-radius:12px;
      cursor:pointer;
      backdrop-filter:blur(10px);
    }
    .sunset-timer{
      position:absolute;
      bottom:60px;
      color:white;
      font-size:40px;
      font-weight:700;
      text-shadow:0 2px 10px rgba(0,0,0,0.6);
    }

    @media (max-width:600px){
      .card{
        padding:18px 16px;
      }
      .sunset-timer{
        bottom:40px;
      }
    }
  </style>
</head>

<body>
  <!-- FULLSCREEN BACKGROUND IMAGES -->
  <div class="background-slideshow">
    <img src="sunset-1.jpeg" class="slide active" alt="Sunset 1">
    <img src="sunset-2.jpeg" class="slide" alt="Sunset 2">
    <img src="sunset-3.jpeg" class="slide" alt="Sunset 3">
    <img src="Sunset-4.jpeg" class="slide" alt="Sunset 4">
    <img src="Sunset-5.jpeg" class="slide" alt="Sunset 5">
    <img src="Sunset-6.jpeg" class="slide" alt="Sunset 6">
    <img src="Sunset-7.jpeg" class="slide" alt="Sunset 7">
  </div>
  <div class="bg-overlay"></div>

  <div class="page">
    <header>
      <h1 id="title">Soulset Navigator</h1>
      <div class="subtitle" id="subtitle"></div>
    </header>

    <div class="container">
      <!-- EMOTIONAL CHECK-IN -->
      <section class="card">
        <h2 id="check-title">Emotional Check-In</h2>
        <p id="check-desc">
          Describe what you're feeling. You will receive emotional reflection and therapeutic micro-practices.
        </p>

        <textarea id="inputText" placeholder="Ex: I feel overwhelmedâ€¦"></textarea>

        <div class="actions">
          <button class="btn" id="analyzeBtn">Reflect with me</button>
          <button class="btn secondary" id="clearBtn">Clear</button>
        </div>

        <div id="status"></div>
        <div id="result"></div>
      </section>

      <!-- SUNSET RESET BUTTON -->
      <div class="sunset-block" id="sunsetBlock">
        <button class="sunset-btn" id="sunsetBtn">ðŸŒ… Sunset Reset (60s)</button>
      </div>
    </div>
  </div>

  <!-- IMMERSIVE SUNSET FULLSCREEN -->
  <div class="sunset-fullscreen" id="sunsetFS">
    <video id="sunsetVideo" autoplay muted playsinline>
      <source src="Sunset-1V.mp4" type="video/mp4">
    </video>
    <div class="sunset-timer" id="sunsetTimer">60</div>
    <div class="sunset-close" id="sunsetClose">Ã—</div>
  </div>

  <script>
    // ---------- Language + UI ----------
    const lang = (navigator.language || navigator.userLanguage || "en").substring(0,2).toLowerCase();

    function applyLanguageUI(){
      const subtitle = document.getElementById("subtitle");
      const checkTitle = document.getElementById("check-title");
      const checkDesc = document.getElementById("check-desc");
      const analyzeBtn = document.getElementById("analyzeBtn");
      const clearBtn = document.getElementById("clearBtn");
      const inputText = document.getElementById("inputText");

      if(lang === "fr"){
        subtitle.textContent = "Avant de parler Ã  un thÃ©rapeute, parlez Ã  votre guide intÃ©rieur. Il vous Ã©coute vraiment.";
        checkTitle.textContent = "Bilan Ã©motionnel";
        checkDesc.textContent = "DÃ©crivez ce que vous ressentez. Vous recevrez un miroir Ã©motionnel et des micro-pratiques thÃ©rapeutiques.";
        analyzeBtn.textContent = "Explorer avec moi";
        clearBtn.textContent = "Effacer";
        inputText.placeholder = "Ex : Je me sens submergÃ©(e)â€¦";
      } else if(lang === "es"){
        subtitle.textContent = "Antes de hablar con un terapeuta, habla con tu guÃ­a interior. Ã‰l realmente te escucha.";
        checkTitle.textContent = "RevisiÃ³n emocional";
        checkDesc.textContent = "Describe lo que sientes. RecibirÃ¡s un espejo emocional y microprÃ¡cticas terapÃ©uticas.";
        analyzeBtn.textContent = "Explorar conmigo";
        clearBtn.textContent = "Borrar";
        inputText.placeholder = "Ej: Me siento abrumado(a)â€¦";
      } else if(lang === "ar"){
        subtitle.textContent = "Ù‚Ø¨Ù„ Ø£Ù† ØªØªØ­Ø¯Ø« Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬ØŒ ØªØ­Ø¯Ù‘Ø« Ø¥Ù„Ù‰ Ø¯Ù„ÙŠÙ„Ùƒ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ. Ø¥Ù†Ù‡ ÙŠÙ†ØµØª Ø¥Ù„ÙŠÙƒ Ø­Ù‚Ù‹Ø§.";
        checkTitle.textContent = "ØªÙ‚ÙŠÙŠÙ… Ø¹Ø§Ø·ÙÙŠ";
        checkDesc.textContent = "ØµÙ Ù…Ø§ ØªØ´Ø¹Ø± Ø¨Ù‡. Ø³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù†Ø¹ÙƒØ§Ø³ Ø¹Ø§Ø·ÙÙŠ ÙˆÙ…Ù…Ø§Ø±Ø³Ø§Øª Ø¹Ù„Ø§Ø¬ÙŠØ© ØµØºÙŠØ±Ø©.";
        analyzeBtn.textContent = "Ø§Ø³ØªÙƒØ´ÙÙ Ù…Ø¹ÙŠ";
        clearBtn.textContent = "Ù…Ø³Ø­";
        inputText.placeholder = "Ù…Ø«Ø§Ù„: Ø£Ø´Ø¹Ø± Ø¨Ø£Ù†Ù†ÙŠ Ù…ÙØ±Ù‡Ù‚â€¦";
      } else {
        subtitle.textContent = "Before talking to a therapist, speak to your inner guide. It truly listens to you.";
        checkTitle.textContent = "Emotional Check-In";
        checkDesc.textContent = "Describe what you're feeling. You'll receive emotional reflection and therapeutic micro-practices.";
        analyzeBtn.textContent = "Reflect with me";
        clearBtn.textContent = "Clear";
        inputText.placeholder = "Ex: I feel overwhelmedâ€¦";
      }
    }
    applyLanguageUI();

    // ---------- Background slideshow ----------
    const slidesBG = document.querySelectorAll(".background-slideshow .slide");
    let bgIndex = 0;
    if(slidesBG.length > 0){
      setInterval(() => {
        slidesBG[bgIndex].classList.remove("active");
        bgIndex = (bgIndex + 1) % slidesBG.length;
        slidesBG[bgIndex].classList.add("active");
      }, 9000);
    }

    // ---------- Helper render ----------
    const resultEl = document.getElementById("result");
    const statusEl = document.getElementById("status");
    const sunsetBlock = document.getElementById("sunsetBlock");
    const analyzeBtn = document.getElementById("analyzeBtn");
    const clearBtn = document.getElementById("clearBtn");
    const inputEl = document.getElementById("inputText");

    function renderMessage(text){
      const div = document.createElement("div");
      div.className = "bubble";
      div.innerHTML = text;
      resultEl.innerHTML = "";
      resultEl.appendChild(div);
    }

    // ---------- AI Analysis ----------
    analyzeBtn.onclick = async () => {
      const text = inputEl.value.trim();
      if(!text) return;

      analyzeBtn.disabled = true;
      clearBtn.disabled = true;
      statusEl.textContent = (lang === "fr") ? "Analyse en coursâ€¦" : "Analyzingâ€¦";
      renderMessage("â³ " + ((lang === "fr") ? "Je tâ€™Ã©couteâ€¦" : "Iâ€™m listeningâ€¦"));

      try{
        const res = await fetch("/api/analyze", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body:JSON.stringify({ text, lang })
        });
        const data = await res.json();

        if(data.ok){
          renderMessage(data.text);
          sunsetBlock.style.display = "block";
          statusEl.textContent = "";
        } else {
          renderMessage("âš ï¸ Something went wrong.");
          statusEl.textContent = "";
        }
      }catch(err){
        console.error(err);
        renderMessage("âš ï¸ Network error, please try again.");
        statusEl.textContent = "";
      } finally{
        analyzeBtn.disabled = false;
        clearBtn.disabled = false;
      }
    };

    clearBtn.onclick = () => {
      inputEl.value = "";
      resultEl.innerHTML = "";
      statusEl.textContent = "";
      sunsetBlock.style.display = "none";
    };

    // ---------- Sunset Reset immersive ----------
    const FS = document.getElementById("sunsetFS");
    const video = document.getElementById("sunsetVideo");
    const timer = document.getElementById("sunsetTimer");
    const sunsetBtn = document.getElementById("sunsetBtn");
    const sunsetClose = document.getElementById("sunsetClose");
    let countdown;

    if(sunsetBtn){
      sunsetBtn.onclick = () => {
        FS.style.display = "flex";
        video.currentTime = 0;
        video.play();

        let time = 60;
        timer.textContent = time;

        clearInterval(countdown);
        countdown = setInterval(() => {
          time--;
          timer.textContent = time;
          if(time <= 0){
            closeSunset();
          }
        }, 1000);
      };
    }

    function closeSunset(){
      FS.style.display = "none";
      video.pause();
      clearInterval(countdown);
    }

    if(sunsetClose){
      sunsetClose.onclick = closeSunset;
    }
  </script>
</body>
</html>
