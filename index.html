<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Soulset Navigator â€¢ Therapeutic Support</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    body{
      margin:0;
      font-family:Nunito, sans-serif;
      background:#f5f6f8;
      color:#334;
      -webkit-font-smoothing:antialiased;
    }

    /* HERO IMAGE CAROUSEL */
    .hero{
      position:relative;
      height:45vh;
      max-height:420px;
      overflow:hidden;
      border-bottom-left-radius:28px;
      border-bottom-right-radius:28px;
      box-shadow:0 8px 20px rgba(0,0,0,0.2);
    }
    .hero img{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
      opacity:0;
      transition:opacity 1.4s ease;
    }
    .hero img.active{ opacity:1; }

    header{
      text-align:center;
      padding:26px 20px 10px;
    }
    header h1{
      font-family:"Playfair Display", serif;
      font-size:clamp(28px,4.8vw,38px);
      margin:0;
    }
    header .subtitle{
      opacity:0.8;
      font-size:15px;
      margin-top:8px;
    }

    /* Cards */
    .container{
      max-width:860px;
      margin:0 auto;
      padding:20px;
    }

    .card{
      background:white;
      border-radius:20px;
      padding:22px 20px;
      box-shadow:0 6px 20px rgba(0,0,0,0.08);
      margin-bottom:28px;
    }

    .card h2{
      margin:0 0 14px;
      font-size:20px;
      font-family:"Playfair Display", serif;
    }

    textarea{
      width:100%;
      min-height:100px;
      border-radius:14px;
      border:1.5px solid #ccd7dd;
      padding:14px;
      font-size:16px;
      background:#f9fbfc;
      resize:vertical;
      outline:none;
      color:#334;
    }

    .actions{
      display:flex;
      gap:12px;
      margin-top:14px;
    }

    .btn{
      flex:1;
      border:0;
      padding:14px;
      border-radius:14px;
      font-size:15px;
      font-weight:700;
      cursor:pointer;
      background:#5aa3a6;
      color:white;
    }
    .btn.secondary{
      background:#e9f1f1;
      color:#355;
    }

    #result .bubble{
      margin-top:18px;
      background:#ffffff;
      padding:16px 18px;
      border-radius:16px;
      box-shadow:0 4px 16px rgba(0,0,0,0.08);
      line-height:1.6;
      white-space:pre-line;
    }

    /* Sunset Reset Button */
    .sunset-block{
      display:none;
      text-align:center;
      margin-bottom:60px;
    }
    .sunset-btn{
      background:#ffffffcc;
      padding:14px 22px;
      border-radius:18px;
      font-weight:700;
      box-shadow:0 6px 16px rgba(0,0,0,0.15);
      backdrop-filter:blur(10px);
      color:#334;
    }


    /* IMMERSIVE SUNSET RESET */
    .sunset-fullscreen{
      position:fixed;
      inset:0;
      background:black;
      display:none;
      justify-content:center;
      align-items:center;
      flex-direction:column;
      z-index:9999;
    }
    .sunset-fullscreen video{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .sunset-close{
      position:absolute;
      top:30px;
      right:30px;
      font-size:30px;
      color:white;
      padding:8px 16px;
      background:#ffffff33;
      border-radius:12px;
      cursor:pointer;
      backdrop-filter:blur(8px);
    }
    .sunset-timer{
      position:absolute;
      bottom:60px;
      color:white;
      font-size:40px;
      font-weight:700;
      text-shadow:0 2px 10px rgba(0,0,0,0.6);
    }
  </style>
</head>

<body>

  <!-- HERO WITH RANDOM IMAGES -->
  <div class="hero">
    <img src="sunset1.jpg" class="active">
    <img src="sunset2.jpg">
    <img src="sunset3.jpg">
    <img src="sunset4.jpg">
    <img src="sunset5.jpg">
  </div>

  <header>
    <h1 id="title">Soulset Navigator</h1>
    <div class="subtitle" id="subtitle"></div>

<script>
  // Detect system language
  let lang = navigator.language.substring(0,2);

  function applyLanguageUI(){
    const title = document.getElementById("title");
    const subtitle = document.getElementById("subtitle");
    const checkTitle = document.getElementById("check-title");
    const checkDesc = document.getElementById("check-desc");
    const analyzeBtn = document.getElementById("analyzeBtn");
    const clearBtn = document.getElementById("clearBtn");
    const inputText = document.getElementById("inputText");

    if(lang === "fr"){
      subtitle.textContent = "Avant de parler Ã  un thÃ©rapeute, parlez Ã  votre guide intÃ©rieur. Il vous Ã©coute vraiment.";
      checkTitle.textContent = "Bilan Ã©motionnel";
      checkDesc.textContent = "DÃ©crivez ce que vous ressentez. Vous recevrez un miroir Ã©motionnel et des micro-pratiques thÃ©rapeutiques.";
      analyzeBtn.textContent = "Explorer avec moi";
      clearBtn.textContent = "Effacer";
      inputText.placeholder = "Ex : Je me sens submergÃ©(e)â€¦";
    }
    else if(lang === "es"){
      subtitle.textContent = "Antes de hablar con un terapeuta, habla con tu guÃ­a interior. Ã‰l realmente te escucha.";
      checkTitle.textContent = "RevisiÃ³n emocional";
      checkDesc.textContent = "Describe lo que sientes. RecibirÃ¡s un espejo emocional y microprÃ¡cticas terapÃ©uticas.";
      analyzeBtn.textContent = "Explorar conmigo";
      clearBtn.textContent = "Borrar";
      inputText.placeholder = "Ej: Me siento abrumado(a)â€¦";
    }
    else if(lang === "ar"){
      subtitle.textContent = "Ù‚Ø¨Ù„ Ø£Ù† ØªØªØ­Ø¯Ø« Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬ØŒ ØªØ­Ø¯Ù‘Ø« Ø¥Ù„Ù‰ Ø¯Ù„ÙŠÙ„Ùƒ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ. Ø¥Ù†Ù‡ ÙŠÙ†ØµØª Ø¥Ù„ÙŠÙƒ Ø­Ù‚Ù‹Ø§.";
      checkTitle.textContent = "ØªÙ‚ÙŠÙŠÙ… Ø¹Ø§Ø·ÙÙŠ";
      checkDesc.textContent = "ØµÙ Ù…Ø§ ØªØ´Ø¹Ø± Ø¨Ù‡. Ø³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù†Ø¹ÙƒØ§Ø³ Ø¹Ø§Ø·ÙÙŠ ÙˆÙ…Ù…Ø§Ø±Ø³Ø§Øª Ø¹Ù„Ø§Ø¬ÙŠØ© ØµØºÙŠØ±Ø©.";
      analyzeBtn.textContent = "Ø§Ø³ØªÙƒØ´ÙÙ Ù…Ø¹ÙŠ";
      clearBtn.textContent = "Ù…Ø³Ø­";
      inputText.placeholder = "Ù…Ø«Ø§Ù„: Ø£Ø´Ø¹Ø± Ø¨Ø£Ù†Ù†ÙŠ Ù…ÙØ±Ù‡Ù‚â€¦";
    }
    else {
      // DEFAULT: ENGLISH
      subtitle.textContent = "Before talking to a therapist, speak to your inner guide. It truly listens to you.";
      checkTitle.textContent = "Emotional Check-In";
      checkDesc.textContent = "Describe what you're feeling. You'll receive emotional reflection and therapeutic micro-practices.";
      analyzeBtn.textContent = "Reflect with me";
      clearBtn.textContent = "Clear";
      inputText.placeholder = "Ex: I feel overwhelmedâ€¦";
    }
  }

  // Run on load
  applyLanguageUI();
</script>

  </header>

  <div class="container">

    <!-- EMOTIONAL CHECK-IN -->
    <section class="card">
      <h2 id="check-title">Emotional Check-In</h2>
      <p id="check-desc" style="color:#667;">
        Describe what you're feeling. You will receive emotional reflection and therapeutic micro-practices.
      </p>

      <textarea id="inputText" placeholder="Ex: I feel overwhelmedâ€¦"></textarea>

      <div class="actions">
        <button class="btn" id="analyzeBtn">Reflect with me</button>
        <button class="btn secondary" id="clearBtn">Clear</button>
      </div>
      <div id="status" style="margin-top:12px;color:#555;font-size:14px;"></div>
      <div id="result"></div>
    </section>

    <!-- SUNSET RESET BUTTON -->
    <div class="sunset-block" id="sunsetBlock">
      <button class="sunset-btn" id="sunsetBtn">ğŸŒ… Sunset Reset (60s)</button>
    </div>

  </div>

  <!-- IMMERSIVE SUNSET FULLSCREEN -->
  <div class="sunset-fullscreen" id="sunsetFS">
    <video id="sunsetVideo" autoplay muted playsinline>
      <source src="Sunset-1V.mp4" type="video/mp4">
    </video>
    <div class="sunset-timer" id="sunsetTimer">60</div>
    <div class="sunset-close" id="sunsetClose">Ã—</div>
  </div>

  <script>
    /* â€”â€”â€” Language Auto Detection â€”â€”â€” */
    let lang = navigator.language.substring(0,2);

    function applyLang(l){
      if(l === "fr"){
        document.getElementById("title").textContent = "Soulset Navigator";
        document.getElementById("subtitle").textContent = "Votre soutien thÃ©rapeutique, mÃªme avant une consultation.";
        document.getElementById("check-title").textContent = "Bilan Ã©motionnel";
        document.getElementById("check-desc").textContent = "DÃ©crivez ce que vous ressentez. Vous recevrez un miroir Ã©motionnel et des micro-pratiques thÃ©rapeutiques.";
        document.getElementById("analyzeBtn").textContent = "Explorer avec moi";
        document.getElementById("clearBtn").textContent = "Effacer";
        document.getElementById("inputText").placeholder = "Ex : Je me sens vidÃ©(e)â€¦";
      }
    }
    applyLang(lang);


    /* â€”â€”â€” HERO CAROUSEL â€”â€”â€” */
    const slides = document.querySelectorAll(".hero img");
    let idx = 0;
    setInterval(()=>{
      slides[idx].classList.remove("active");
      idx = (idx+1) % slides.length;
      slides[idx].classList.add("active");
    }, 5000);

    /* â€”â€”â€” RENDER MESSAGE â€”â€”â€” */
    function renderMessage(text){
      const div = document.createElement("div");
      div.className = "bubble";
      div.innerHTML = text;
      result.innerHTML = "";
      result.appendChild(div);
    }


    /* â€”â€”â€” AI ANALYSIS â€”â€”â€” */
    document.getElementById("analyzeBtn").onclick = async ()=>{
      const text = document.getElementById("inputText").value.trim();
      if(!text) return;

      status.innerText = (lang==="fr") ? "Analyse en coursâ€¦" : "Analyzingâ€¦";
      renderMessage("â³ " + ((lang==="fr") ? "Je tâ€™Ã©couteâ€¦" : "Iâ€™m listeningâ€¦"));

      try{
        const res = await fetch("/api/analyze", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body:JSON.stringify({ text, lang })
        });
        const data = await res.json();

        if(data.ok){
          renderMessage(data.text);
          document.getElementById("sunsetBlock").style.display = "block";
        }
        status.innerText = "";
      }catch(e){
        renderMessage("âš ï¸ Error");
      }
    };


    /* â€”â€”â€” CLEAR â€”â€”â€” */
    document.getElementById("clearBtn").onclick = ()=>{
      document.getElementById("inputText").value="";
      result.innerHTML="";
      status.innerHTML="";
      document.getElementById("sunsetBlock").style.display = "none";
    };


    /* â€”â€”â€” SUNSET RESET IMMERSIVE â€”â€”â€” */
    const FS = document.getElementById("sunsetFS");
    const video = document.getElementById("sunsetVideo");
    const timer = document.getElementById("sunsetTimer");

    let countdown;

    document.getElementById("sunsetBtn").onclick = ()=>{
      FS.style.display="flex";
      video.currentTime=0;
      video.play();

      let time=60;
      timer.innerText=time;

      countdown=setInterval(()=>{
        time--;
        timer.innerText=time;
        if(time<=0) closeSunset();
      },1000);
    };

    function closeSunset(){
      FS.style.display="none";
      video.pause();
      clearInterval(countdown);
    }

    document.getElementById("sunsetClose").onclick = closeSunset;
  </script>
</body>
</html>
